using SERVICES.Dominio;
using SERVICES.DTO;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace SERVICES.DAL.Contratos
{
    public interface IUsuarioDAL : IGenericServiceDAL<Usuario>
    {
        /// <summary>
        /// Obtiene un usuario por su nombre de usuario.
        /// </summary>
        /// <param name="username">El nombre de usuario.</param>
        /// <returns>El usuario correspondiente, si existe.</returns>
        Usuario GetUsuarioByUsername(string username);

        /// <summary>
        /// Obtiene un usuario por su ID.
        /// </summary>
        /// <param name="idUsuario">El ID del usuario.</param>
        /// <returns>El usuario correspondiente, si existe.</returns>
        Usuario GetUsuarioById(Guid idUsuario);

        /// <summary>
        /// Crea un nuevo usuario en la base de datos.
        /// </summary>
        /// <param name="usuario">El usuario a crear.</param>
        void CreateUsuario(Usuario usuario);

        /// <summary>
        /// Actualiza los datos de un usuario existente.
        /// </summary>
        /// <param name="usuario">El usuario con los datos actualizados.</param>
        void UpdateUsuario(Usuario usuario);

        /// <summary>
        /// Deshabilita un usuario por su ID.
        /// </summary>
        /// <param name="idUsuario">El ID del usuario.</param>
        void DisableUsuario(Guid idUsuario);

        /// <summary>
        /// Habilita un usuario por su ID.
        /// </summary>
        /// <param name="idUsuario">El ID del usuario.</param>
        void EnabledUsuario(Guid idUsuario);

        /// <summary>
        /// Obtiene todos los usuarios activos del sistema.
        /// </summary>
        /// <returns>Lista de usuarios activos.</returns>
        List<Usuario> GetUsuariosActivos();

        /// <summary>
        /// Actualiza los accesos de un usuario.
        /// </summary>
        /// <param name="idUsuario">El ID del usuario.</param>
        /// <param name="accesos">La lista de accesos a asignar al usuario.</param>
        void UpdateAccesos(Guid idUsuario, List<Acceso> accesos);

        // ===== GESTIÓN DE FAMILIAS =====

        /// <summary>
        /// Asigna una familia a un usuario.
        /// </summary>
        /// <param name="idUsuario">El ID del usuario.</param>
        /// <param name="idFamilia">El ID de la familia.</param>
        void AsignarFamiliaAUsuario(Guid idUsuario, Guid idFamilia);

        /// <summary>
        /// Remueve una familia de un usuario.
        /// </summary>
        /// <param name="idUsuario">El ID del usuario.</param>
        /// <param name="idFamilia">El ID de la familia.</param>
        void RemoverFamiliaDeUsuario(Guid idUsuario, Guid idFamilia);

        /// <summary>
        /// Obtiene las familias asignadas a un usuario.
        /// </summary>
        /// <param name="idUsuario">El ID del usuario.</param>
        /// <returns>Lista de familias asignadas.</returns>
        List<Familia> GetFamiliasByUsuarioId(Guid idUsuario);

        // ===== GESTIÓN DE PATENTES =====

        /// <summary>
        /// Asigna una patente a un usuario.
        /// </summary>
        /// <param name="idUsuario">El ID del usuario.</param>
        /// <param name="idPatente">El ID de la patente.</param>
        void AsignarPatenteAUsuario(Guid idUsuario, Guid idPatente);

        /// <summary>
        /// Remueve una patente de un usuario.
        /// </summary>
        /// <param name="idUsuario">El ID del usuario.</param>
        /// <param name="idPatente">El ID de la patente.</param>
        void RemoverPatenteDeUsuario(Guid idUsuario, Guid idPatente);

        /// <summary>
        /// Obtiene las patentes asignadas directamente a un usuario.
        /// </summary>
        /// <param name="idUsuario">El ID del usuario.</param>
        /// <returns>Lista de patentes asignadas.</returns>
        List<Patente> GetPatentesByUsuarioId(Guid idUsuario);

        // ===== VALIDACIONES =====

        /// <summary>
        /// Verifica si existe un usuario con el nombre de usuario especificado.
        /// </summary>
        /// <param name="username">El nombre de usuario a verificar.</param>
        /// <returns>True si existe, false en caso contrario.</returns>
        bool ExisteUsuarioPorUsername(string username);

        /// <summary>
        /// Verifica si existe un usuario con el DNI especificado.
        /// </summary>
        /// <param name="dni">El DNI a verificar.</param>
        /// <returns>True si existe, false en caso contrario.</returns>
        bool ExisteUsuarioPorDNI(string dni);

        // ===== MÉTODOS EXISTENTES =====

        /// <summary>
        /// Crea una nueva patente en la base de datos.
        /// </summary>
        /// <param name="patente">La patente a crear.</param>
        void CreatePatente(Patente patente);

        /// <summary>
        /// Obtiene una lista de usuarios con sus respectivas familias, para generar un reporte.
        /// </summary>
        /// <returns>Una lista de <see cref="UsuarioFamiliaDTO"/> que representa los usuarios con sus familias asociadas.</returns>
        List<UsuarioFamiliaDto> GetUsuariosConFamilias();

        /// <summary>
        /// Establece un código OTP para un usuario con una fecha de expiración.
        /// </summary>
        /// <param name="idUsuario">El ID del usuario.</param>
        /// <param name="otp">El código OTP a establecer.</param>
        /// <param name="expiry">La fecha de expiración del código OTP.</param>
        void SetOTP(Guid idUsuario, string otp, DateTime expiry);

        /// <summary>
        /// Obtiene un usuario por su nombre de usuario, incluyendo su información de OTP.
        /// </summary>
        /// <param name="username">El nombre de usuario.</param>
        /// <returns>El usuario correspondiente, si existe, con su OTP.</returns>
        Usuario GetUsuarioByUsernameWithOTP(string username);

        /// <summary>
        /// Actualiza la contraseña de un usuario.
        /// </summary>
        /// <param name="idUsuario">El ID del usuario.</param>
        /// <param name="newPassword">La nueva contraseña.</param>
        void UpdatePassword(Guid idUsuario, string newPassword);
    }
}
